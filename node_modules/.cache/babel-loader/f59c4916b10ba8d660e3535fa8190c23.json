{"ast":null,"code":"var _jsxFileName = \"/Users/shaktishah/Desktop/Coding Temple/2022/week_07/01/hw1/src/contexts/AuthProvider.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useState, useEffect, useContext } from \"react\";\nimport { browserLocalPersistence, getAuth, GoogleAuthProvider, onAuthStateChanged, setPersistence, signInWithPopup, createUserWithEmailAndPassword, signOut } from \"firebase/auth\";\nimport { getFirestore, setDoc, doc } from \"firebase/firestore\"; // import { getAuth, createUserWithEmailAndPassword } from \"firebase/auth\";\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext(); // to make your own React Hook\n\nexport function useAuth() {\n  _s();\n\n  return useContext(AuthContext);\n}\n\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nconst AuthProvider = _ref => {\n  _s2();\n\n  let {\n    children\n  } = _ref;\n  const [currentUser, setCurrentUser] = useState({\n    loggedIn: false\n  });\n  let auth = getAuth();\n  const provider = new GoogleAuthProvider();\n  const db = getFirestore();\n\n  const signIn = () => {\n    return setPersistence(auth, browserLocalPersistence).then(() => {\n      signInWithPopup(auth, provider).then(result => {\n        console.log(result);\n      });\n    }).catch(err => console.log(err));\n  };\n\n  const signup = (email, password) => {\n    createUserWithEmailAndPassword(auth, email, password).then(userCredential => {\n      // Signed in\n      const user = userCredential.user; // ...\n    }).catch(error => {\n      const errorCode = error.code;\n      const errorMessage = error.message; // ..\n    });\n  };\n\n  const logOut = () => {\n    signOut(auth).then(() => {\n      setCurrentUser({\n        loggedIn: false\n      });\n      console.log('User logged out successfully');\n    });\n  };\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, user => {\n      if (user) {\n        // once the user logs in, we need to add them to the database as a reference\n        // query the users collection to find the user\n        const useRef = doc(db, 'users', user.uid); // if that user doesn't exist, add them to the database\n        // otherwise, if the user does exist, overwrite (don't duplicate) their information\n\n        setDoc(useRef, {\n          email: user.email,\n          name: user.displayName\n        }, {\n          merge: true\n        });\n        setCurrentUser({\n          id: user.uid,\n          name: user.displayName,\n          image: user.photoURL,\n          email: user.email,\n          loggedIn: true\n        });\n        return unsubscribe;\n      }\n    });\n  }, [auth, db]);\n  const values = {\n    signIn,\n    currentUser,\n    logOut,\n    signup\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: values,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 9\n  }, this);\n};\n\n_s2(AuthProvider, \"2bTO6xhbyu21yGNDed9VuG/s7sg=\");\n\n_c = AuthProvider;\nexport default AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/shaktishah/Desktop/Coding Temple/2022/week_07/01/hw1/src/contexts/AuthProvider.js"],"names":["createContext","useState","useEffect","useContext","browserLocalPersistence","getAuth","GoogleAuthProvider","onAuthStateChanged","setPersistence","signInWithPopup","createUserWithEmailAndPassword","signOut","getFirestore","setDoc","doc","AuthContext","useAuth","AuthProvider","children","currentUser","setCurrentUser","loggedIn","auth","provider","db","signIn","then","result","console","log","catch","err","signup","email","password","userCredential","user","error","errorCode","code","errorMessage","message","logOut","unsubscribe","useRef","uid","name","displayName","merge","id","image","photoURL","values"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect, useContext } from \"react\";\nimport {\n  browserLocalPersistence,\n  getAuth,\n  GoogleAuthProvider,\n  onAuthStateChanged,\n  setPersistence,\n  signInWithPopup,\n  createUserWithEmailAndPassword,\n  signOut,\n} from \"firebase/auth\";\nimport { getFirestore, setDoc, doc } from \"firebase/firestore\";\n// import { getAuth, createUserWithEmailAndPassword } from \"firebase/auth\";\n\nexport const AuthContext = createContext()\n\n// to make your own React Hook\nexport function useAuth() {\n    return useContext( AuthContext )\n}\n\nconst AuthProvider = ( { children } ) => {\n\n    const [currentUser, setCurrentUser] = useState( { loggedIn: false } )\n    let auth = getAuth();\n    const provider = new GoogleAuthProvider();\n    const db = getFirestore()\n    const signIn = () => {\n        return setPersistence( auth, browserLocalPersistence )\n                .then ( () => {\n                    signInWithPopup( auth, provider)\n                        .then( result => {\n                            console.log( result )\n                        })\n                })\n                .catch( err => console.log( err ))\n    }\n    const signup = (email, password) => {\n          createUserWithEmailAndPassword(auth, email, password)\n          .then((userCredential) => {\n            // Signed in\n            const user = userCredential.user;\n            // ...\n          })\n          .catch((error) => {\n            const errorCode = error.code;\n            const errorMessage = error.message;\n            // ..\n          });\n    }\n    const logOut = () => {\n        signOut( auth )\n            .then( () => {\n                setCurrentUser( { loggedIn: false } )\n                console.log('User logged out successfully')\n            } )\n    }\n    useEffect(() => {\n      const unsubscribe = onAuthStateChanged(auth, (user) => {\n        if (user) {\n            // once the user logs in, we need to add them to the database as a reference\n            // query the users collection to find the user\n            const useRef = doc( db, 'users', user.uid)\n            // if that user doesn't exist, add them to the database\n            // otherwise, if the user does exist, overwrite (don't duplicate) their information\n            setDoc( useRef, { email: user.email, name: user.displayName}, { merge: true } )\n            setCurrentUser({\n                id: user.uid,\n                name: user.displayName,\n                image: user.photoURL,\n                email: user.email,\n                loggedIn: true\n            });\n          return unsubscribe\n        }\n      });\n    }, [ auth, db ]);\n    \n    const values = {\n      signIn,\n      currentUser,\n      logOut,\n      signup\n    };\n    return (\n        <AuthContext.Provider value={values}>\n            {children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthProvider;"]},"metadata":{},"sourceType":"module"}